# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 123374 2014-08-08 21:53:07Z mojca@macports.org $

PortSystem          1.0

name                plumed2
PortGroup           mpi 1.0

version             2.2.2
categories          science
license             gpl
maintainers         gmail.com:giovanni.bussi
description         plumed2
long_description    plumed2
platforms           darwin

homepage            http://www.plumed.org/
master_sites        http://github.com/plumed/plumed2/archive/
distfiles           v${version}.tar.gz

checksums           rmd160  a817137c5fe5c24433b7bf0cbe8b3fcdc3b2cd03 \
                    sha256  c64745c28dd033a44278579cfbc67d042d777de503b259ca0d9ea1bfa30945b2

patch.pre_args -p1
# These patches are required to incorporate the features needed for macports
# to work. They have been included upstream, so will not be necessary with
# next plumed release (2.2.3)
patchfiles patch-Added-disable-dependency-tracking-to-.-configure.diff \
           patch-Added-all_plus_docs-target.diff \
           patch-Added-mdroot-to-patch.diff

# Disable additional features.
# they are then re-enabled when selecting proper variants
# this is important for features that require an additional package to be
# sure that even if the user has that package already installed plumed is
# not going to use it.
configure.args --disable-matheval --disable-xdrfile --disable-molfile-plugins --disable-zlib --disable-mpi

compilers.choose    cc cxx
mpi.setup

if {[mpi_variant_isset]} {
  configure.args-delete --disable-mpi
}

variant matheval description {Enable libmatheval} {
  configure.args-delete --disable-matheval
  depends_lib-append port:libmatheval
}

variant xdrfile description {Enable xdrfile} {
  configure.args-delete --disable-xdrfile
  depends_lib-append port:xdrfile
}

variant zlib description {Enable zlib} {
  configure.args-delete --disable-zlib
  depends_lib-append port:zlib
}

variant molfile description {Enable molfile} {
  configure.args-delete --disable-molfile-plugins
}

variant extra_modules description {Enable extra modules} {
  configure.args-append --enable-modules=crystallization:manyrestraints
}
 
variant debug description {Enable debug flags} {
  configure.args-append --enable-debug
}

variant doc description {Also compile documentation} {
  depends_build-append port:doxygen
  depends_build-append port:graphviz
  build.target all_plus_docs
}

default_variants +matheval +xdrfile +zlib

